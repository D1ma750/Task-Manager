{% extends 'core/base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>üë§ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h1>
    <a href="/employees/" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h4>{{ employee.first_name }} {{ employee.last_name }}</h4>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p><strong>–ö–æ–¥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</strong> {{ employee.employee_code }}</p>
                <p><strong>–î–æ–ª–∂–Ω–æ—Å—Ç—å:</strong> {{ employee.position }}</p>
                <p><strong>–û—Ç–¥–µ–ª:</strong> {{ employee.department }}</p>
            </div>
            <div class="col-md-6">
                <p><strong>Email:</strong> {{ employee.email }}</p>
                <p><strong>–í—Å–µ–≥–æ –∑–∞–¥–∞—á:</strong> <span class="badge bg-primary">{{ tasks|length }}</span></p>
            </div>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5>üíº –ù–∞–≤—ã–∫–∏ ({{ skills|length }})</h5>
        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#addSkillModal">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤—ã–∫
        </button>
    </div>
    <div class="card-body">
        {% if skills %}
            <div class="row">
                {% for skill in skills %}
                <div class="col-md-4 mb-3">
                    <div class="p-3 border rounded position-relative">
                        <strong>{{ skill.skill_name }}</strong>
                        <br>
                        <small class="text-muted">
                            –£—Ä–æ–≤–µ–Ω—å:
                            <span class="badge
                                {% if skill.skill_level == 'expert' %}bg-success
                                {% elif skill.skill_level == 'intermediate' %}bg-warning
                                {% else %}bg-secondary{% endif %}">
                                {{ skill.skill_level }}
                            </span>
                        </small>
                        <form method="POST" action="/skill/{{ employee.id }}/{{ skill.skill_name }}/delete/" class="d-inline"
                              onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—ã–∫ ¬´{{ skill.skill_name }}¬ª?')">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-danger position-absolute top-0 end-0 m-1"
                                    title="–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—ã–∫">üóëÔ∏è</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-muted">–ù–∞–≤—ã–∫–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã</p>
        {% endif %}
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h5>üìã –ó–∞–¥–∞—á–∏ ({{ tasks|length }})</h5>
    </div>
    <div class="card-body">
        {% if tasks %}
            <div class="table-responsive">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>–ö–æ–¥</th>
                            <th>–ó–∞–¥–∞—á–∞</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
                            <th>–°—Ä–æ–∫</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in tasks %}
                        <tr>
                            <td><strong>{{ task.task_code }}</strong></td>
                            <td>
                                <a href="/tasks/{{ task.id }}/">{{ task.title }}</a>
                            </td>
                            <td>
                                <span class="badge
                                    {% if task.status == 'done' %}bg-success
                                    {% elif task.status == 'in_progress' %}bg-primary
                                    {% elif task.status == 'review' %}bg-warning
                                    {% else %}bg-secondary{% endif %}">
                                    {{ task.status }}
                                </span>
                            </td>
                            <td>
                                <span class="badge
                                    {% if task.priority == 'high' %}bg-danger
                                    {% elif task.priority == 'medium' %}bg-warning
                                    {% else %}bg-info{% endif %}">
                                    {{ task.priority }}
                                </span>
                            </td>
                            <td>{{ task.due_date }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-muted">–ó–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã</p>
        {% endif %}
    </div>
</div>

<div class="modal fade" id="addSkillModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤—ã–∫</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="/skill/add/">
                {% csrf_token %}
                <div class="modal-body">
                    <input type="hidden" name="employee_id" value="{{ employee.id }}">
                    <div class="mb-3">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–≤—ã–∫–∞</label>
                        <input type="text" class="form-control" name="skill_name" required
                               placeholder="Python, SQL, JavaScript...">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–£—Ä–æ–≤–µ–Ω—å –≤–ª–∞–¥–µ–Ω–∏—è</label>
                        <select class="form-select" name="skill_level" required>
                            <option value="beginner">üë∂ –ù–∞—á–∞–ª—å–Ω—ã–π</option>
                            <option value="intermediate" selected>üë®‚Äçüíª –°—Ä–µ–¥–Ω–∏–π</option>
                            <option value="expert">üëë –≠–∫—Å–ø–µ—Ä—Ç</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-success">‚úÖ –î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}